{"openapi":"3.0.1","info":{"title":"IBM Cloud Code Engine","description":"The purpose is to provide an API to get Kubeconfig file for IBM Cloud Code Engine Project","version":"0.0","x-sdk-supported-languages":["go","java","node","python"],"x-documentation-sections":[{"name":"Introduction","id":"introduction","blocks":[{"content":[{"type":"text","source":["<p>IBM Cloud Code Engine provides a platform to unify the deployment of functions, applications, and pre-built containers to a Kubernetes-based infrastructure, enabling higher productivity and a faster time to market. Code Engine is built on open-source projects such as Kubernetes, Istio, Knative, and Tekton. For more information about custom resource definition methods that are available to use with Code Engine, see <a href=\"https://cloud.ibm.com/docs/codeengine?topic=codeengine-api\">API reference</a>.</p>"]}],"examples":[{"type":"text","source":["<p data-hd-programlang=\"curl\">The <code>curl</code> examples require a bearer token. You can retrieve a token with the following command.</p>"]},{"type":"code","source":["ibmcloud iam oauth-tokens --output json\n"],"lang":"curl"},{"type":"text","source":["<p data-hd-programlang=\"curl\">You can also use <code>jq</code> to get clean output.</p>"]},{"type":"code","source":["token=`ibmcloud iam oauth-tokens --output json | jq .iam_token -r`\n"],"lang":"curl"},{"type":"text","source":["<p data-hd-programlang=\"java\">These code examples use the client library that is provided for Java.</p>"]},{"type":"text","source":["<p data-hd-programlang=\"java\">Maven</p>"]},{"type":"code","source":["<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">dependency</span>&gt;</span>","\n    ","<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">groupId</span>&gt;</span>","com.ibm.cloud","<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">groupId</span>&gt;</span>","\n    ","<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">artifactId</span>&gt;</span>","code-engine","<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">artifactId</span>&gt;</span>","\n    ","<span class=\"hljs-tag\">&lt;<span class=\"hljs-name\">version</span>&gt;</span>","0.3.3","<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">version</span>&gt;</span>","\n","<span class=\"hljs-tag\">&lt;/<span class=\"hljs-name\">dependency</span>&gt;</span>","\n"],"lang":"java"},{"type":"text","source":["<p data-hd-programlang=\"java\">GitHub</p>"]},{"type":"text","source":["<p data-hd-programlang=\"java\">\n  <code><a href=\"https://github.com/IBM/code-engine-java-sdk\">https://github.com/IBM/code-engine-java-sdk</a></code>\n</p>"]},{"type":"text","source":["<p data-hd-programlang=\"node\">These code examples use the client library that is provided for Node.js.</p>"]},{"type":"text","source":["<p data-hd-programlang=\"node\">Installation</p>"]},{"type":"code","source":["npm install ibm-code-engine-sdk\n"],"lang":"node"},{"type":"text","source":["<p data-hd-programlang=\"node\">GitHub</p>"]},{"type":"text","source":["<p data-hd-programlang=\"node\">\n  <code><a href=\"https://github.com/IBM/code-engine-node-sdk\">https://github.com/IBM/code-engine-node-sdk</a></code>\n</p>"]},{"type":"text","source":["<p data-hd-programlang=\"python\">These code examples use the client library that is provided for Python.</p>"]},{"type":"text","source":["<p data-hd-programlang=\"python\">Installation</p>"]},{"type":"code","source":["pip install --upgrade ","<span class=\"hljs-string\">&quot;ibm-code-engine-sdk&quot;</span>","\n"],"lang":"python"},{"type":"text","source":["<p data-hd-programlang=\"python\">GitHub</p>"]},{"type":"text","source":["<p data-hd-programlang=\"python\">\n  <code><a href=\"https://github.com/IBM/code-engine-python-sdk\">https://github.com/IBM/code-engine-python-sdk</a></code>\n</p>"]},{"type":"text","source":["<p data-hd-programlang=\"go\">These code examples use the client library that is provided for Go.</p>"]},{"type":"code","source":["go get -u github.com/IBM/code-engine-go-sdk\n"],"lang":"go"},{"type":"text","source":["<p data-hd-programlang=\"go\">GitHub</p>"]},{"type":"text","source":["<p data-hd-programlang=\"go\">\n  <code><a href=\"https://github.com/IBM/code-engine-go-sdk\">https://github.com/IBM/code-engine-go-sdk</a></code>\n</p>"]}]}]},{"name":"Authentication","id":"authentication","blocks":[{"content":[{"type":"text","source":["<p>You can create and manage Identity and Access Management (IAM)-based projects in Code Engine. IAM-based projects are created in resource groups and are managed with IAM access policies.</p>"]},{"type":"text","source":["<p>This API requires IBM Cloud Identity and Access Management (IAM) authentication. You can retrieve your IAM access token by running <code>ibmcloud iam oauth-tokens</code>. You must pass the IAM token in the <code>Authorization</code> header.</p>"]},{"type":"text","source":["<p>For specific information about using IAM with Code Engine APIs, see the <a href=\"https://cloud.ibm.com/docs/codeengine?topic=codeengine-api\">API reference</a>.</p>"]}],"examples":[]}]},{"name":"Service endpoint","id":"service-endpoint","blocks":[{"content":[{"type":"text","source":["<p>The service endpoint is based on the location of the service instance. For example, when Code Engine is hosted in Dallas, TX, the base URL is <a href=\"https://api.us-south.codeengine.cloud.ibm.com\">https://api.us-south.codeengine.cloud.ibm.com</a>. </p>"]},{"type":"text","source":["<p>To find out which URL to use, view the service credentials by clicking the service instance in the Resource list. Use that URL in your requests to Code Engine.</p>"]},{"type":"text","source":["<p>All locations might not support Code Engine. For more information, see <a href=\"https://cloud.ibm.com/docs/codeengine?topic=codeengine-regions\">Regions</a>.</p>"]}],"examples":[]}]},{"name":"Error handling","id":"error-handling","blocks":[{"content":[{"type":"text","source":["<p>This API uses standard HTTP response codes to indicate whether a method completed successfully. A <code>200</code> response always indicates success. A <code>400</code> type response is some sort of failure, and a <code>500</code> type response usually indicates an internal system error.</p>"]},{"type":"text","source":["<table>\n<thead>\n<tr>\n<th>HTTP error code</th>\n<th>Description</th>\n<th>Recovery</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code>200</code></td>\n<td>Success</td>\n<td>The request was successful.</td>\n</tr>\n<tr>\n<td><code>400</code></td>\n<td>Bad Request</td>\n<td>The input parameters in the request body are either incomplete or in the wrong format. Be sure to include all required parameters in your request.</td>\n</tr>\n<tr>\n<td><code>401</code></td>\n<td>Unauthorized</td>\n<td>You are not authorized to make this request. Log in to IBM Cloud and try again. If this error persists, contact the account owner to check your permissions.</td>\n</tr>\n<tr>\n<td><code>403</code></td>\n<td>Forbidden</td>\n<td>The supplied authentication is not authorized to access &#39;{project}&#39;. Check that you have the correct access credentials and permissions.</td>\n</tr>\n<tr>\n<td><code>404</code></td>\n<td>Not Found</td>\n<td>The requested resource could not be found. Check that the namespace ID is correct and try again.</td>\n</tr>\n<tr>\n<td><code>408</code></td>\n<td>Request Timeout</td>\n<td>The connection to the server timed out. Wait a few minutes, then try again.</td>\n</tr>\n<tr>\n<td><code>409</code></td>\n<td>Conflict</td>\n<td>The entity is already in the requested state.</td>\n</tr>\n<tr>\n<td><code>500</code></td>\n<td>Internal Server Error</td>\n<td>IBM Cloud Code Engine is currently unavailable. Your request could not be processed. Please wait a few minutes and try again. If you still encounter this problem, note the incident ID and contact the IBM Cloud support.</td>\n</tr>\n</tbody>\n</table>"]}],"examples":[]}]}],"x-last-updated":"2021-03-03"},"servers":[{"url":"/api/v1"}],"paths":{"/project/{id}/config":{"get":{"tags":["get kubeconfig"],"summary":"Retrieve KUBECONFIG for a specified project.","description":"Returns the KUBECONFIG, similar to the output of `kubectl config view --minify=true`.\nThere are 2 tokens in the Request Header and a query parameter that you must provide.\n These values can be generated as follows:\n1. Auth Header\nPass the generated IAM Token as the Authorization header from the CLI as `token=cat $HOME/.bluemix/config.json | jq .IAMToken -r`.\nGenerate the token with the [Create an IAM access token for a user or service ID using an API key](https://cloud.ibm.com/apidocs/iam-identity-token-api#gettoken-apikey) API.\n\n2. X-Delegated-Refresh-Token Header\nGenerate an IAM Delegated Refresh Token for Code Engine with the [Create an IAM access token and delegated refresh token for a user or service ID](https://cloud.ibm.com/apidocs/iam-identity-token-api#gettoken-apikey-delegatedrefreshtoken) API.\nSpecify the `receiver_client_ids` value to be `ce` and the `delegated_refresh_token_expiry` value to be `3600`.\n\n3. Project ID\nIn order to retrieve the Kubeconfig file for a specific Code Engine project, use the CLI to extract the ID\n`id=ibmcloud ce project get -n ${CE_PROJECT_NAME} -o jsonpath={.guid}`\nYou must be logged into the account where the project was created to retrieve the ID.","operationId":"get_kubeconfig","security":[{"authorizationHeader":[]}],"parameters":[{"name":"X-Delegated-Refresh-Token","in":"header","description":"This IAM Delegated Refresh Token is specifically valid for Code Engine. Generate this token with the [Create an IAM access token and delegated refresh token for a user or service ID](https://cloud.ibm.com/apidocs/iam-identity-token-api#gettoken-apikey-delegatedrefreshtoken) API. Specify the `receiver_client_ids` value to be `ce` and the `delegated_refresh_token_expiry` value to be `3600`","required":true,"schema":{"type":"string"}},{"name":"id","in":"path","description":"The id of the IBM Cloud Code Engine project","required":true,"schema":{"type":"string"}}],"responses":{"200":{"description":"Success. The returned content is the KUBECONFIG information to use for the specific IBM Cloud Code Engine project. The returned value must be stored in a .yaml file and exported as `export KUBECONFIG=<path to the .yaml file>` for use.","content":{"text/plain":{"schema":{"type":"string"},"example":"apiVersion: v1\nclusters:\n- cluster:\n    server: https://proxy.us-south.codeengine.cloud.ibm.com\n  name: https://proxy.us-south.codeengine.cloud.ibm.com\ncontexts:\n- context:\n    cluster: https://proxy.us-south.codeengine.cloud.ibm.com\n    namespace: some-namespace\n    user: some-namespace\n  name: some-namespace\ncurrent-context: some-namespace\nkind: Config\npreferences: {}\nusers:\n- name: some-namespace\n  user:\n    auth-provider:\n      config:\n        client-id: ce\n        client-secret: ce\n        id-token: a.b.c\n        idp-issuer-url: https://iam.cloud.ibm.com/identity\n        refresh-token: c.d.e\n      name: oidc"},"application/json":{"schema":{"type":"object"}}}},"400":{"description":"Bad request","headers":{"X-Request-Id":{"description":"Unique ID for this request","schema":{"type":"string"}}},"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MessagePayload"}}}},"401":{"description":"Unauthorized","headers":{"X-Request-Id":{"description":"Unique ID for this request","schema":{"type":"string"}}},"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MessagePayload"}}}},"403":{"description":"Unauthorized access","headers":{"X-Request-Id":{"description":"Unique ID for this request","schema":{"type":"string"}}},"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MessagePayload"}}}},"500":{"description":"Internal Server Error","headers":{"X-Request-Id":{"description":"Unique ID for this request","schema":{"type":"string"}}},"content":{"application/json":{"schema":{"$ref":"#/components/schemas/MessagePayload"}}}}},"x-sdk-operations":{"request-examples":{"curl":[{"name":"Example request","example":[{"type":"code","source":["token=`cat $HOME/.bluemix/config.json | jq .IAMToken -r`\n","refreshToken=`cat $HOME/.bluemix/config.json | jq .IAMRefreshToken -r`\n","delegatedRefreshToken=$(curl -X POST 'https://iam.cloud.ibm.com/identity/token' \\\n","  -H 'Content-Type: application/x-www-form-urlencoded' \\\n","  -H 'Authorization: Basic Yng6Yng=' \\\n","  -d \"grant_type=refresh_token&refresh_token=${refreshToken}&response_type=delegated_refresh_token&receiver_client_ids=ce&delegated_refresh_token_expiry=3600\" \\\n"," | jq .delegated_refresh_token -r)\n","id=`ibmcloud ce project get -n ${CE_PROJECT_NAME} -o jsonpath={.guid}`\n","curl -H \"Authorization: ${token}\" -H \"X-Delegated-Refresh-Token: ${delegatedRefreshToken}\" \\\n","  https://api.${CE_PROJECT_REGION}.codeengine.cloud.ibm.com/api/v1/project/${id}/config\""]}]}],"java":[{"name":"Example request","example":[{"lang":"java","type":"code","source":["IamAuthenticator authenticator = new IamAuthenticator(System.getenv(\"CE_API_KEY\"));\n","authenticator.setClientIdAndSecret(\"bx\", \"bx\");\n","\n","IbmCloudCodeEngine ceClient = new IbmCloudCodeEngine(\"Code Engine Client\", authenticator);\n","ceClient.setServiceUrl(\"https://api.\" + System.getenv(\"CE_PROJECT_REGION\") + \".codeengine.cloud.ibm.com/api/v1\");\n","\n","URL iamUrl = new URL(\"https://iam.cloud.ibm.com/identity/token?\"\n","  + \"grant_type=urn:ibm:params:oauth:grant-type:apikey&\"\n","  + \"response_type=delegated_refresh_token&\"\n","  + \"receiver_client_ids=ce&\"\n","  + \"delegated_refresh_token_expiry=3600&\"\n","  + \"apikey=\"\n","  + System.getenv(\"CE_API_KEY\"));\n","HttpURLConnection iamConnection = (HttpURLConnection) iamUrl.openConnection();\n","iamConnection.setRequestMethod(\"POST\");\n","iamConnection.setRequestProperty(\"Content-Type\", \"application/x-www-form-urlencoded\");\n","BufferedReader iamInput = new BufferedReader(new InputStreamReader(iamConnection.getInputStream()));\n","String iamResponse = \"\";\n","String iamInputLine = \"\";\n","while ((iamInputLine = iamInput.readLine()) != null) {\n","  iamResponse = iamResponse + iamInputLine;\n","}\n","iamInput.close();\n","JSONObject iamJson = new JSONObject(iamResponse);\n","String delegatedRefreshToken = iamJson.getString(\"delegated_refresh_token\");\n","\n","GetKubeconfigOptions options = new GetKubeconfigOptions.Builder()\n","  .id(System.getenv(\"CE_PROJECT_ID\"))\n","  .xDelegatedRefreshToken(delegatedRefreshToken)\n","  .build();\n","\n","Response<String> kubeConfigResponse = ceClient.getKubeconfig(options).execute();\n","String kubeConfigString = kubeConfigResponse.getResult();\n"]}]}],"node":[{"name":"Example request","example":[{"lang":"node","type":"code","source":["const authenticator = new IamAuthenticator({\n","  apikey: process.env.CE_API_KEY,\n","  clientId: 'bx',\n","  clientSecret: 'bx',\n","});\n","\n","const ceClient = new CodeEngineV1({\n","  authenticator,\n","  serviceUrl: `https://api.${process.env.CE_PROJECT_REGION}.codeengine.cloud.ibm.com/api/v1`,\n","});\n","\n","const iamResponse = await axios.post('https://iam.cloud.ibm.com/identity/token', querystring.stringify({\n","  grant_type: 'urn:ibm:params:oauth:grant-type:apikey',\n","  apikey: process.env.CE_API_KEY,\n","  response_type: 'delegated_refresh_token',\n","  receiver_client_ids: 'ce',\n","  delegated_refresh_token_expiry: '3600'\n","}), {\n","  headers: {\n","    'Content-Type': 'application/x-www-form-urlencoded'\n","  }\n","})\n","const delegatedRefreshToken = iamResponse.data.delegated_refresh_token;\n","\n","const configResponse = await ceClient.getKubeconfig({\n","  xDelegatedRefreshToken: delegatedRefreshToken,\n","  id: process.env.CE_PROJECT_ID,\n","});\n"]}]}],"python":[{"name":"Example request","example":[{"lang":"python","type":"code","source":["authenticator = IAMAuthenticator(\n","    apikey=os.environ.get('CE_API_KEY'),\n","    client_id='bx',\n","    client_secret='bx',\n",")\n","\n","ce_client = IbmCloudCodeEngineV1(authenticator=authenticator)\n","ce_client.set_service_url(\n","    'https://api.' + os.environ.get('CE_PROJECT_REGION') + '.codeengine.cloud.ibm.com/api/v1'\n",")\n","\n","iam_response = requests.post('https://iam.cloud.ibm.com/identity/token', headers={\n","    'Content-Type': 'application/x-www-form-urlencoded'\n","}, data={\n","    'grant_type': 'urn:ibm:params:oauth:grant-type:apikey',\n","    'apikey': os.environ.get('CE_API_KEY'),\n","    'response_type': 'delegated_refresh_token',\n","    'receiver_client_ids': 'ce',\n","    'delegated_refresh_token_expiry': '3600'\n","})\n","delegated_refresh_token = iam_response.json()['delegated_refresh_token']\n","\n","kubeconfig_response = ce_client.get_kubeconfig(\n","    x_delegated_refresh_token=delegated_refresh_token,\n","    id=os.environ.get('CE_PROJECT_ID'),\n",")\n","kubeconfig_string = kubeconfig_response.get_result().content\n"]}]}],"go":[{"name":"Example request","example":[{"lang":"go","type":"code","source":["authenticator := &core.IamAuthenticator{\n","  ApiKey:       os.Getenv(\"CE_API_KEY\"),\n","  ClientId:     \"bx\",\n","  ClientSecret: \"bx\",\n","}\n","\n","ceClient, _ := ibmcloudcodeenginev1.NewIbmCloudCodeEngineV1(&ibmcloudcodeenginev1.IbmCloudCodeEngineV1Options{\n","  Authenticator: authenticator,\n","  URL:           \"https://api.\" + os.Getenv(\"CE_PROJECT_REGION\") + \".codeengine.cloud.ibm.com/api/v1\",\n","})\n","\n","iamRequestData := url.Values{}\n","iamRequestData.Set(\"grant_type\", \"urn:ibm:params:oauth:grant-type:apikey\")\n","iamRequestData.Set(\"apikey\", os.Getenv(\"CE_API_KEY\"))\n","iamRequestData.Set(\"response_type\", \"delegated_refresh_token\")\n","iamRequestData.Set(\"receiver_client_ids\", \"ce\")\n","iamRequestData.Set(\"delegated_refresh_token_expiry\", \"3600\")\n","client := &http.Client{}\n","req, _ := http.NewRequest(\"POST\", \"https://iam.cloud.ibm.com/identity/token\", strings.NewReader(iamRequestData.Encode()))\n","req.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\n","resp, _ := client.Do(req)\n","var iamResponseData map[string]string\n","json.NewDecoder(resp.Body).Decode(&iamResponseData)\n","delegatedRefreshToken := iamResponseData[\"delegated_refresh_token\"]\n","\n","projectID := os.Getenv(\"CE_PROJECT_ID\")\n","result, _, _ := ceClient.GetKubeconfig(&ibmcloudcodeenginev1.GetKubeconfigOptions{\n","  XDelegatedRefreshToken: &delegatedRefreshToken,\n","  ID:           &projectID,\n","})\n"]}]}]}}}}},"components":{"securitySchemes":{"authorizationHeader":{"type":"http","scheme":"bearer","bearerFormat":"JWT"}},"schemas":{"MessagePayload":{"required":["message","messageid","statuscode","timestamp","x-request-id"],"type":"object","properties":{"message":{"type":"string","x-go-name":"Message","description":"message returned with the status code"},"messageid":{"type":"string","x-go-name":"MessageID","description":"Unique identifier for the message"},"statuscode":{"type":"integer","format":"int64","x-go-name":"StatusCode","description":"status code associated with the API response"},"timestamp":{"type":"string","format":"date-time","x-go-name":"TimeStamp","description":"Time of the message generation"},"x-request-id":{"type":"string","x-go-name":"RequestID"}},"description":"MessagePayload -","x-go-package":"github.ibm.com/coligo/api-server/lib"}}}}